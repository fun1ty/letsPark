<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script
      type="text/javascript"
      src="https://cdn.iamport.kr/js/iamport.payment-1.1.5.js"
    ></script>
    <script
      type="text/javascript"
      src="https://code.jquery.com/jquery-1.12.4.min.js"
    ></script>
    <title>Document</title>
  </head>
  <body>
    <input type="text" id="startTime" placeholder="주차 시작 시간" />
    <input type="text" id="endTime" placeholder="주차 종료 시간" />
    <button onclick="requestParkingFee()">결제하기</button>

    <script>
      // 주차 요금 결제 요청 함수
      function requestParkingFee() {
        // 주차 시작 시간과 종료 시간을 입력 받아옵니다.
        const startTime = document.getElementById("startTime").value;
        const endTime = document.getElementById("endTime").value;

        // 서버로 결제 정보 전송 (AJAX 또는 fetch 사용)
        fetch("/api/pay", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            startTime,
            endTime,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              // 아임포트 결제창 열기
              const IMP = window.IMP;
              IMP.init("imp55871858");

              // 결제 정보 설정
              const payData = {
                pg: "html5_inicis",
                pay_method: "card",
                merchant_uid: data.merchant_uid,
                name: "주차 요금 결제",
                amount: data.amount,
                buyer_email: "buyer@example.com",
                buyer_name: "홍길동",
                buyer_tel: "010-1234-5678",
                buyer_addr: "서울특별시 강남구",
                buyer_postcode: "12345",
                m_redirect_url: "/",
              };

              // 아임포트 결제창 열기
              IMP.request_pay(payData, function (rsp) {
                if (rsp.success) {
                  // 결제 성공 시 실행할 코드
                  alert("결제가 성공했습니다.");
                } else {
                  // 결제 실패 시 실행할 코드
                  alert("결제가 실패했습니다. 오류 메시지: " + rsp.error_msg);
                }
              });
            } else {
              alert("서버로부터 결제 정보를 가져오는데 실패했습니다.");
            }
          })
          .catch((error) => {
            console.error("에러 발생:", error);
            alert("결제 요청 중 에러가 발생했습니다.");
          });
      }
    </script>
  </body>
</html>
